# -*- coding: utf-8 -*-

from odoo import models, fields, api
import logging

_logger = logging.getLogger("::User Feedback::")

class user_feedback(models.Model):
    _name = 'user.feedback.model'

    name = fields.Char(string="Folio", required=True)
    url = fields.Char(string="url", required=True)
    rating=fields.Integer(string="Rating", required=True)
    description = fields.Char(string=u"Descripción")
    screenshot = fields.Binary(string="Imagen")
    user=fields.Many2one('res.users', 'Usuario', required=True)
    state=fields.Selection([('attended', 'Contestado'), ('non_attended', 'Sin Contestar')], default='non_attended',string='Estado')
    response=fields.Text(string="Respuesta enviada")
    coord_vert=fields.Integer(string="Coord. vertical")
    coord_hor=fields.Integer(string="Coord. horizontal")
    screenshot_fname=fields.Char("Nombre del archivo screenshot")

    def send_mail(self):
        for rec in self:
            rec.state='attended'
            mail_pool = self.env['mail.mail']
            para=rec.user.login
            de = self.env['res.users'].browse(self.env.uid).partner_id.email
            _logger.warning('de '+de)
            _logger.warning('para '+para)
            if rec.response:
                mensaje= u'Su peticion fue recibida, el equipo de desarrolladores le notifca:\n'+rec.response
            else:
                raise models.ValidationError(u'Por favor escriba una respuesta.')
            values = {'subject': 'Respuesta Feedback',
                      'email_to': para,
                      'auto_delete': False,
                      'reply_to': de,
                      'email_from': de,
                      'body_html': u'<div style="width:100%;max-width:700px;margin:0 auto;font-family:Calibri,Tahoma,Geneva,Verdana,sans-serif"><img src="https://ci5.googleusercontent.com/proxy/uC9rvy6eGyeC5jbcsfyJrBdBpCWwOk70Fq9n05LoYbxVLGNwtuixYrtx534s-mqYetIs30EoVcxN3iEJUQjlbJwxBz22sQHi5ewuK5tiHnj7YbHaWI9xri8A9-uLUkllQdi1mIpwCiGNZRHiszE=s0-d-e1-ft#https://res.cloudinary.com/rg-asesores/image/upload/v1559875852/Branding/logo-RG_kessdt.png" alt="Logo RG Asesores" style="width:90%;max-width:150px;display:block;margin:20px auto" class="CToWUd"/><div style="width:100%;background-color:#e06f1d;color:#ffffff;text-align:center;padding:5px 40px;text-transform:uppercase;box-sizing:border-box"><h2>' +
                       rec.user.name + u'</h2><p><b>' + mensaje + u'</b></p></div><table style="width:100%;border-collapse:collapse;border:none;color:#ffffff"><tbody><tr><td style="text-align:center;width:33%;padding:10px;background-color:#007bb5"></td><td style="text-align:center;width:34%;padding:10px;background-color:rgba(0,124,181,0.70)"></td><td style="text-align:center;width:33%;padding:10px;background-color:rgba(0,124,181,0.40)"></td></tr></tbody></table><div style="width:100%;background:url(\'https://ci3.googleusercontent.com/proxy/WAuNeRiRyq8jw35-mNjaqDNqDqIa-ALEBtAiR08sJCXC4RHhCbknPQXb4v05Dd1Kb2yq4YWzgE2cmwjqPWxDPO-zIPucTKxUdEOUtKx7U7XBJ5Srk6LgqL-G8jZb7JxZToggWQ4GOSvDRHTWyHbLRxYO4b6HjhcpN6RP9V5YLKNb4I2r-lrgzEU=s0-d-e1-ft#https://res.cloudinary.com/rg-asesores/image/upload/v1561580556/Email%20Marketing/Carta%20Renovaciones/back_qmropb.jpg\') bottom center no-repeat;background-size:contain;color:#515254;padding-bottom:30px"><div style="width:90%;margin:30px auto;padding:5px 40px;background-color:rgba(255,255,255,0.5);box-sizing:border-box"><h3>¡PROTÉGETE CON LOS MEJORES!</h3><ul style="margin:0;padding:20px"><li>Ponte en contacto con tu inquilino a efecto de que pueda negociar los nuevos lineamientos del contrato.</li><li>Revisa que estén al corriente en pago de rentas y servicios.</li><li>Infórmanos la fecha de firma de nuevo contrato de arrendamiento para elaborar tu contrato y renovar tu protección (Serán necesarias las firmas de todas las partes, incluyendo al fiador o fiadores).</li></ul><h3>¡RENOVAR ES MUY FÁCIL! ANTES DE HACERLO RECUERDA QUE...:</h3><ul style="margin:0;padding:20px"><li>Asegurate que el inquilino esté al corriente en pago de rentas y servicios.</li><li>Después de 10 días del vencimiento, tu contrato de arrendamiento se vuelve de tiempo indefinido.</li><li><b>Obtén un 10% de descuento en el costo de cobertura si renuevas 10 días antes del vencimiento.</b></li><li>Si no renuevas tu contrato te sugerimos firmar en conjunto con tu inquilino una acta de entrega recepcion, ¡podemos asesorarte!.</li><li>Si quieres terminar el contrato y tu inquilino no quiere desocupar, considera los plazos que se establecen al reverso de tu certificado de cobertura.</li></ul></div><div style="width:100%;text-align:center"></div><div style="width:90%;margin:30px auto 0;padding:5px 40px;background-color:rgba(255,255,255,0.5);box-sizing:border-box;text-align:center"><div style="width:40%;padding:30px 0;text-align:center;display:inline-block"><a href="https://wa.me/5215534322307" style="color:#515254;text-decoration:none" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://wa.me/5215534322307&amp;source=gmail&amp;ust=1579625841674000&amp;usg=AFQjCNGi3nzwPYFo1ZwkAwks8YrfU8JpbA"><img src="https://ci6.googleusercontent.com/proxy/ZI7EfrJ3hI1Pw9c0V5E_-YST0959ZRLeGYhydfKes_jhoQcB3gpAg_hRF3BbYzCVsBO8haZX9hFSTtDWGGxo_RDhyLYyNN_CmO3-rUJ0ZSZoZXFDnSBph7AnvBuWDHl9Fulz4Ep-RC5LcVe_27NCEpy8qe6QqTDbOLMhfWHMYu8bydHIO3DhB59uCShk=s0-d-e1-ft#https://res.cloudinary.com/rg-asesores/image/upload/v1561585761/Email%20Marketing/Carta%20Renovaciones/whatsapp_qgq3sc.png" style="width:20px;vertical-align:middle" class="CToWUd"> +52 (55) 3432 2307</a></div><div style="width:40%;padding:30px;text-align:center;display:inline-block"><a href="mailto:info@rgasesores.com.mx" style="color:#515254;font-weight:bold" target="_blank"><img src="https://ci5.googleusercontent.com/proxy/x-_Ckn0NGN8KDZkCGyKeMMX1Os2wKgyx4braGlUIbTuxVCijGLHypBn76DLU-73k-97xwZVFWLpaRE4Jmvf7iY9irCg1C6guc2pB21tdEzKFn7if-v8_xomEs6fs8y7vXH4AZ7IvSt5UuTWBrWCIkz643ukMzREJA-JGgeSFMEEtN3W9w7ilrdxc=s0-d-e1-ft#https://res.cloudinary.com/rg-asesores/image/upload/v1561585761/Email%20Marketing/Carta%20Renovaciones/email_bfrt0c.png" style="width:20px;vertical-align:middle" class="CToWUd"> info@rgasesores.com.mx</a></div></div></div><div style="width:100%;background-color:#007bb5;color:#ffffff;text-align:center"><div style="width:40%;padding:10px 0;text-align:center;display:inline-block"><p>Insurgentes Sur 1377 5to Piso<br>Col. Insurgentes Mixcoac</p></div><div style="width:40%;padding:10px 0;text-align:center;display:inline-block"><p><a href="https://www.facebook.com/AsesoresRG/" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://www.facebook.com/AsesoresRG/&amp;source=gmail&amp;ust=1579625841674000&amp;usg=AFQjCNEaJHJw-9S_hoZrTJajgfMP0maDNw"><img src="https://ci4.googleusercontent.com/proxy/unXjzRCyepG-zp7XBpyFxNAD2CyfVzCFw37p2z13S0uzb1eP13vEsv9PdwYcY6qsU97lZhZZQaydF3aDjh3B19F0ZVYYsgHGkcNr9k2HD8zrZGnidsT0ZfWmdS7kiIm83HIgnGDYex2LU4GEaFN_9kI6J9igbdgU4Il3C2GNuL867dHgT0nH2qE=s0-d-e1-ft#https://res.cloudinary.com/rg-asesores/image/upload/v1561586879/Email%20Marketing/Carta%20Renovaciones/face_j0tnav.png" style="width:20px;margin:0 5px" class="CToWUd"/></a> <a href="https://www.instagram.com/rg_asesores/" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://www.instagram.com/rg_asesores/&amp;source=gmail&amp;ust=1579625841674000&amp;usg=AFQjCNFLB1lAaspluwwXmw1d3y53CuDofw"><img src="https://ci3.googleusercontent.com/proxy/wYlWBKlelzEJPJ9gDOxpNK7iUD7X4Vevodo97Fxp9cIzu6HsYAcnowD4eGmJx4QrCjXaHxb0sGujTiKJqf2E5C9x2lg1Qa-70Lz_z2pnaeq7AKG1fponXsEe9by90B22lJiQIbyY9zTWGLtobOR0RZ8nvmdIWskB_mQWnrLFzpk3A07qlN9-ytml=s0-d-e1-ft#https://res.cloudinary.com/rg-asesores/image/upload/v1561586879/Email%20Marketing/Carta%20Renovaciones/insta_udssya.png" style="width:20px;margin:0 5px" class="CToWUd"/></a> <a href="https://www.linkedin.com/company/rg-asesores/" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://www.linkedin.com/company/rg-asesores/&amp;source=gmail&amp;ust=1579625841674000&amp;usg=AFQjCNEEJ9yQquuWSd7ZV1mfE0tAxdSFRw"><img src="https://ci5.googleusercontent.com/proxy/hwgElJtrtsUykghUkOvB-RsSj8ZhprcZvbriPFBLONA3rx8mQuVjq6GSytJr6vvEY6kEBus6TbMjnKqiCLfWtvB5on3gltpKowFQK4RofWw7BTCbsLbncIbR50TbvHlzWJC2OaLn1QyypbQcIsThqTpSn_kZWBb7LvYVTwBNza1LNyWyvH9HanI5Mg=s0-d-e1-ft#https://res.cloudinary.com/rg-asesores/image/upload/v1561586879/Email%20Marketing/Carta%20Renovaciones/linked_knowua.png" style="width:20px;margin:0 5px" class="CToWUd"/></a><br/><a href="https://www.rgasesores.com.mx" style="color:#ffffff" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://www.rgasesores.com.mx&amp;source=gmail&amp;ust=1579625841674000&amp;usg=AFQjCNHQwVOSjOAwZLrivStvL7V7oVFZcw">www.rgasesores.com.mx</a></p></div></div></div><p style="text-align:center"><a href="http://email.mg.rgasesores.com.mx/u/eJx9kVFvpCAUhX-NvJAYQFHngYdpddpNZnd2p-lk0zcUtDQKG3AmTX99LzpJ2zTZRFHOPVfPd1GCSE0qhfSL7s6zuTjx0ByREYzQDSkJoxmnGU1pWtMNq5v8huzqm6auSZKTaUj9IIMOzuuQdm5Kp1f0LHirStJ2BVNFmVeclLzts56VpVQt3Ap5bWcpfv5NWE6zhN1yQlJCkPRQUHIyUHYxQHV8qDYlR8p43XXGWXEIDvw4J3H9nd6n8ESdg0YnvFPeDG5w9iLfIN0wSTPGVGAYnTVS1M0en7b7fYP8f9xnP4rnef4XkmybsB1cvfNT-I4KFQjsLjJG02DfGZVk9UfwhBXWTa3XoN4dfj0ljN8CL6_ovokbRk4f0tOfx6t4PNTHH3cH6F7JoPtrWsY_5Y02OY7xH8t0Cv06a2-cB2H5XBxWYexXcZ1dMTkYNWhwyssZgNQbqRZfL8egQQh6OPtomv1ZI2MN4ApSAj3NYYm4aMUUCyTwLID4tL4uYPgKhXpjr83Z2ryB45VB6DBH-5ZiiSnFatnUMmCl8UXbTns0i4Rt3wEXEs77" target="_blank" data-saferedirecturl="https://www.google.com/url?q=http://email.mg.rgasesores.com.mx/u/eJx9kVFvpCAUhX-NvJAYQFHngYdpddpNZnd2p-lk0zcUtDQKG3AmTX99LzpJ2zTZRFHOPVfPd1GCSE0qhfSL7s6zuTjx0ByREYzQDSkJoxmnGU1pWtMNq5v8huzqm6auSZKTaUj9IIMOzuuQdm5Kp1f0LHirStJ2BVNFmVeclLzts56VpVQt3Ap5bWcpfv5NWE6zhN1yQlJCkPRQUHIyUHYxQHV8qDYlR8p43XXGWXEIDvw4J3H9nd6n8ESdg0YnvFPeDG5w9iLfIN0wSTPGVGAYnTVS1M0en7b7fYP8f9xnP4rnef4XkmybsB1cvfNT-I4KFQjsLjJG02DfGZVk9UfwhBXWTa3XoN4dfj0ljN8CL6_ovokbRk4f0tOfx6t4PNTHH3cH6F7JoPtrWsY_5Y02OY7xH8t0Cv06a2-cB2H5XBxWYexXcZ1dMTkYNWhwyssZgNQbqRZfL8egQQh6OPtomv1ZI2MN4ApSAj3NYYm4aMUUCyTwLID4tL4uYPgKhXpjr83Z2ryB45VB6DBH-5ZiiSnFatnUMmCl8UXbTns0i4Rt3wEXEs77&amp;source=gmail&amp;ust=1579625841674000&amp;usg=AFQjCNEDkwkh42G6uENyci0R6gFSMfjCiA">¡Dejar de recibir correos!</a></p><img alt="" src="https://ci4.googleusercontent.com/proxy/zo3O5Yxkl0bU8Q6Ds7yVZEiYaT_HKjBpyi7wIm14xctO2KUmb6aFyw7-ohuRpYntAd7glrsOothE09NDLNOiP1i3WCTO6OpjSHGLzVPKYZBkZs1AirFWNFPaUkHUEzraUY40bNgOd-a_zWjuXHyyUskuXb9lAqrAUHNlgAdGo-YrexcYPHvjyeuy3nmy5V5JcuXb5tvfWHYq9lWTuy3dbRbyAAb5DNuJVfgA6NHCe8scTzOHXEQCeKukLeVTAc8h8bd6rVQ1B5pKDSqWsgkyAK6lZnPFHfdvQVzapcfMe-yi7xiqj0XKgwwyJcYHdH0nc-6ZsSmdI02PbrYJJ8Ju7HBlYlcz_A2GYxNMBJiuZouU8EHW77V8WNNEqWGi7g_vLdH4urGLbYf80m-QQms_YAnn48DvTsWJe4znMW1GABh2Tm2UDRekCB9vM0f04VxqA3IBrgST7jAGpryreIZOF-RIYXIZLxhRbq57UPJD2PLdk0sAdeUJSkWLAwiYB8QNWqNiB-hvepUxlnRRobMZs49ABo-dOy6O5TPOD6t-3vplc2QOyDM8elTqTfz7JeU5EKrkX_GOTrTPhiM2RK4aZdZuju1sWwqC_KXNYTCVAoeFtGbrD7m8BfQYWZG3dlPCLLKLOp7EUDlok82xxiQ6parctkRs2T6B5bwDFvFio3Ly9oiYeJwJSUuUBPoifzvVIzBmVq9xSI7nqpBR5uWWy6o4162IOqcoZZb-eogfLvKCCT89Mh1HA4kYK26wuNcxDq35uA-aNBypkc1CKvYdkwhv-VjEOcNT1teHtK2Q2_Z4CdT3_tnQP1sZWQ=s0-d-e1-ft#http://email.mg.rgasesores.com.mx/o/eJx9Ul1vnDAQ_DX4BQnZ5uPgwQ-XM5dWuuTai3qq8ubihbgCu7K5U5RfnzWclEaVKqEFDzPLzrBaUAW01gR-Q3eZzdWJp_ZEOjc6a5SQ7SE9bw-HlrwIVvBKMc37oq80lFWd50XZNxVTvOMVrYmxpjNO0E3C96zAwimrifIerFaTATs7EaHTU91sSqKNhw4FVhyDS_guLWis37IvGd5xBBQ64Z32ZnCDs1f1lhR0mJQZs85NxMRmDd1QzvKS5SxjmWQNl21xR_fyrpWSIn8aMj-oAMF5CFGXTa_E_6ftxY_iZZ7_hCTfoge8euen8G8XfIPO3FVFD4D0vdFJLj8cJryybvrlAdH74-NzwstdjqVmhzYeOD1_QM_ff9zA01Gevt4fUb1GgOrP0_Lyr3kjTY1j_MYSYwWvM3jjPAJLu5hqZexncA25mhz-E8QwQEozGpm9UXrh9WoMgECA4eIjafYXIOh4VuLhZ8ILhoPvVh1ZfYrFJRpaHKbn9XFxlt5ckd7Y24bk64Y0uAgqCAhzpG9ZqlLGUr0cpAqphvQKtgP_Dq78zJk" width="1px" height="1px" class="CToWUd"/>',
                      'model': 'user.feedback.model'
                      }
            msg_id = mail_pool.create(values)
            if msg_id:
                mail_pool.send([msg_id])

